import{_ as ea}from"./AppDataTable.vue_vue_type_script_setup_true_lang-CM-jAhMs.js";import{W as aa,am as la,an as ta,ao as na,ap as sa,Y as ke,aq as oa,w as de,aa as $e,ar as ra,a3 as ia,q as B,b as a,a7 as G,a9 as ua,ah as ae,L as J,r as g,as as Re,at as Ue,au as da,ac as ca,ae as ma,av as va,aw as fa,i as P,f as M,ax as pa,Q as X,ay as ga,az as ya,aA as Ee,H as De,aB as wa,aC as ba,j as xe,h as he,aD as _a,aE as Va,n as ka,aF as ha,g as k,aG as Ca,E as re,d as Y,aH as ce,a as D,c as le,e as n,x as W,aI as me,t as j,A as ve,I as Ae,V as H,M as qe,o as Se,C as fe,B as pe,m as te,p as I,l as ge,P as xa,R as Fe,S as Aa,T as Sa,U as Pa,J as Ia,_ as $a}from"./main-jtG-UPKi.js";import{g as ye}from"./errors-DCR5ytRp.js";import{l as Pe}from"./roles.api-CzHcYPMY.js";import{u as Ra,m as Ua,a as Ea,b as Fa}from"./VSelect-Co_r_wLT.js";import{u as Da,m as qa,h as za}from"./VDataTable-CJVTAZds.js";import{o as Ce}from"./modal-MMUOoy7A.js";const Ma=ca({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...qa({filterKeys:["title"]}),...Ua(),...ma(va({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),Ie=aa()({name:"VAutocomplete",props:Ma(),emits:{"update:focused":t=>!0,"update:search":t=>!0,"update:modelValue":t=>!0,"update:menu":t=>!0},setup(t,E){let{slots:f}=E;const{t:h}=la(),v=g(),d=ae(!1),o=ae(!0),w=ae(!1),b=g(),i=g(),c=ae(-1),V=ae(null),{items:$,transformIn:C,transformOut:F}=ta(t),{textColorClasses:_,textColorStyles:y}=na(()=>v.value?.color),{InputIcon:p}=sa(t),u=ke(t,"search",""),e=ke(t,"modelValue",[],r=>C(r===null?[null]:fa(r)),r=>{const A=F(r);return t.multiple?A:A[0]??null}),l=J(()=>typeof t.counterValue=="function"?t.counterValue(e.value):typeof t.counterValue=="number"?t.counterValue:e.value.length),s=oa(t),{filteredItems:m,getMatches:T}=Da(t,$,()=>V.value??(o.value?"":u.value)),R=J(()=>t.hideSelected&&V.value===null?m.value.filter(r=>!e.value.some(A=>A.value===r.value)):m.value),N=Ca(()=>t.closableChips&&!s.isReadonly.value&&!s.isDisabled.value),K=J(()=>!!(t.chips||f.chip)),Z=J(()=>K.value||!!f.selection),ze=J(()=>e.value.map(r=>r.props.value)),ne=J(()=>R.value.find(r=>r.type==="item"&&!r.props.disabled)),we=J(()=>(t.autoSelectFirst===!0||t.autoSelectFirst==="exact"&&u.value===ne.value?.title)&&R.value.length>0&&!o.value&&!w.value),ie=J(()=>t.hideNoData&&!R.value.length||s.isReadonly.value||s.isDisabled.value),be=ke(t,"menu"),q=J({get:()=>be.value,set:r=>{be.value&&!r&&b.value?.Î¨openChildren.size||r&&ie.value||(be.value=r)}}),{menuId:Me,ariaExpanded:Le,ariaControls:Be}=Ra(t,q),_e=g(),Te=Fa(_e,v);function Oe(r){t.openOnClear&&(q.value=!0),u.value=""}function je(){ie.value||(q.value=!0)}function Ne(r){ie.value||(d.value&&(r.preventDefault(),r.stopPropagation()),q.value=!q.value)}function We(r){(Re(r)||r.key==="Backspace")&&v.value?.focus()}function Ke(r){if(s.isReadonly.value)return;const A=v.value?.selectionStart,z=e.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(r.key)&&r.preventDefault(),["Enter","ArrowDown"].includes(r.key)&&(q.value=!0),["Escape"].includes(r.key)&&(q.value=!1),we.value&&["Enter","Tab"].includes(r.key)&&ne.value&&!e.value.some(S=>{let{value:L}=S;return L===ne.value.value})&&ee(ne.value),r.key==="ArrowDown"&&we.value&&_e.value?.focus("next"),["Backspace","Delete"].includes(r.key)){if(!t.multiple&&Z.value&&e.value.length>0&&!u.value)return ee(e.value[0],!1);if(~c.value){r.preventDefault();const S=c.value;ee(e.value[c.value],!1),c.value=S>=z-1?z-2:S}else r.key==="Backspace"&&!u.value&&(c.value=z-1);return}if(t.multiple)if(r.key==="ArrowLeft"){if(c.value<0&&A&&A>0)return;const S=c.value>-1?c.value-1:z-1;if(e.value[S])c.value=S;else{const L=u.value?.length??null;c.value=-1,v.value?.setSelectionRange(L,L)}}else if(r.key==="ArrowRight"){if(c.value<0)return;const S=c.value+1;e.value[S]?c.value=S:(c.value=-1,v.value?.setSelectionRange(0,0))}else~c.value&&Re(r)&&(c.value=-1)}function He(r){if(Ue(v.value,":autofill")||Ue(v.value,":-webkit-autofill")){const A=$.value.find(z=>z.title===r.target.value);A&&ee(A)}}function Qe(){t.eager&&i.value?.calculateVisibleItems()}function Ge(){d.value&&(o.value=!0,v.value?.focus()),V.value=null}function Je(r){d.value=!0,setTimeout(()=>{w.value=!0})}function Ye(r){w.value=!1}function Xe(r){(r==null||r===""&&!t.multiple&&!Z.value)&&(e.value=[])}const Ve=ae(!1);function ee(r){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!r||r.props.disabled))if(t.multiple){const z=e.value.findIndex(L=>(t.valueComparator||da)(L.value,r.value)),S=A??!~z;if(~z){const L=S?[...e.value,r]:[...e.value];L.splice(z,1),e.value=L}else S&&(e.value=[...e.value,r]);t.clearOnSelect&&(u.value="")}else{const z=A!==!1;e.value=z?[r]:[],V.value=o.value?"":u.value??"",u.value=z&&!Z.value?r.title:"",$e(()=>{q.value=!1,o.value=!0})}}return de(d,(r,A)=>{r!==A&&(r?(Ve.value=!0,u.value=t.multiple||Z.value?"":String(e.value.at(-1)?.props.title??""),o.value=!0,$e(()=>Ve.value=!1)):(!t.multiple&&u.value==null&&(e.value=[]),q.value=!1,!o.value&&u.value&&(V.value=u.value),u.value="",c.value=-1))}),de(u,r=>{!d.value||Ve.value||(r&&(q.value=!0),o.value=!r)}),de(q,r=>{if(!t.hideSelected&&r&&e.value.length&&o.value){const A=R.value.findIndex(z=>e.value.some(S=>z.value===S.value));ra&&window.requestAnimationFrame(()=>{A>=0&&i.value?.scrollToIndex(A)})}r&&(V.value=null)}),de($,(r,A)=>{q.value||d.value&&!A.length&&r.length&&(q.value=!0)}),ia(()=>{const r=!!(!t.hideNoData||R.value.length||f["prepend-item"]||f["append-item"]||f["no-data"]),A=e.value.length>0,z=B.filterProps(t);return a(B,G({ref:v},z,{modelValue:u.value,"onUpdate:modelValue":[S=>u.value=S,Xe],focused:d.value,"onUpdate:focused":S=>d.value=S,validationValue:e.externalValue,counterValue:l.value,dirty:A,onChange:He,class:["v-autocomplete",`v-autocomplete--${t.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":q.value,"v-autocomplete--chips":!!t.chips,"v-autocomplete--selection-slot":!!Z.value,"v-autocomplete--selecting-index":c.value>-1},t.class],style:t.style,readonly:s.isReadonly.value,placeholder:A?void 0:t.placeholder,"onClick:clear":Oe,"onMousedown:control":je,onKeydown:Ke,"aria-expanded":Le.value,"aria-controls":Be.value}),{...f,default:S=>{let{id:L}=S;return P(X,null,[a(ga,G({id:Me.value,ref:b,modelValue:q.value,"onUpdate:modelValue":U=>q.value=U,activator:"parent",contentClass:"v-autocomplete__content",disabled:ie.value,eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Qe,onAfterLeave:Ge},t.menuProps),{default:()=>[r&&a(ya,G({ref:_e,filterable:!0,selected:ze.value,selectStrategy:t.multiple?"independent":"single-independent",onMousedown:U=>U.preventDefault(),onKeydown:We,onFocusin:Je,onFocusout:Ye,tabindex:"-1",selectable:!!R.value.length,"aria-live":"polite","aria-labelledby":`${L.value}-label`,"aria-multiselectable":t.multiple,color:t.itemColor??t.color},Te,t.listProps),{default:()=>[f["prepend-item"]?.(),!R.value.length&&!t.hideNoData&&(f["no-data"]?.()??a(Ee,{key:"no-data",title:h(t.noDataText)},null)),a(Ea,{ref:i,renderless:!0,items:R.value,itemKey:"value"},{default:U=>{let{item:x,index:Q,itemRef:ue}=U;const se=G(x.props,{ref:ue,key:x.value,active:we.value&&x===ne.value?!0:void 0,onClick:()=>ee(x,null),"aria-posinset":Q+1,"aria-setsize":R.value.length});return x.type==="divider"?f.divider?.({props:x.raw,index:Q})??a(De,G(x.props,{key:`divider-${Q}`}),null):x.type==="subheader"?f.subheader?.({props:x.raw,index:Q})??a(wa,G(x.props,{key:`subheader-${Q}`}),null):f.item?.({item:x,index:Q,props:se})??a(Ee,G(se,{role:"option"}),{prepend:oe=>{let{isSelected:O}=oe;return P(X,null,[t.multiple&&!t.hideSelected?a(ba,{key:x.value,modelValue:O,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Ze=>Ze.preventDefault()},null):void 0,x.props.prependAvatar&&a(xe,{image:x.props.prependAvatar},null),x.props.prependIcon&&a(M,{icon:x.props.prependIcon},null)])},title:()=>o.value?x.title:za("v-autocomplete",x.title,T(x)?.title)})}}),f["append-item"]?.()]})]}),e.value.map((U,x)=>{function Q(O){O.stopPropagation(),O.preventDefault(),ee(U,!1)}const ue=G(he.filterProps(U.props),{"onClick:close":Q,onKeydown(O){O.key!=="Enter"&&O.key!==" "||(O.preventDefault(),O.stopPropagation(),Q(O))},onMousedown(O){O.preventDefault(),O.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),se=K.value?!!f.chip:!!f.selection,oe=se?_a(K.value?f.chip({item:U,index:x,props:ue}):f.selection({item:U,index:x})):void 0;if(!(se&&!oe))return P("div",{key:U.value,class:ka(["v-autocomplete__selection",x===c.value&&["v-autocomplete__selection--selected",_.value]]),style:Va(x===c.value?y.value:{})},[K.value?f.chip?a(ha,{key:"chip-defaults",defaults:{VChip:{closable:N.value,size:"small",text:U.title}}},{default:()=>[oe]}):a(he,G({key:"chip",closable:N.value,size:"small",text:U.title,disabled:U.props.disabled},ue),null):oe??P("span",{class:"v-autocomplete__selection-text"},[U.title,t.multiple&&x<e.value.length-1&&P("span",{class:"v-autocomplete__selection-comma"},[k(",")])])])})])},"append-inner":function(){for(var S=arguments.length,L=new Array(S),U=0;U<S;U++)L[U]=arguments[U];return P(X,null,[f["append-inner"]?.(...L),t.menuIcon?a(M,{class:"v-autocomplete__menu-icon",color:v.value?.fieldIconColor,icon:t.menuIcon,onMousedown:Ne,onClick:pa,"aria-hidden":!0,tabindex:"-1"},null):void 0,t.appendInnerIcon&&a(p,{key:"append-icon",name:"appendInner",color:L[0].iconColor.value},null)])}})}),ua({isFocused:d,isPristine:o,menu:q,search:u,filteredItems:m,select:ee},v)}});function La(t){return re.get("/admin/admin-list",{params:t})}function Ba(t){return re.post("/admin/admin-create",t)}function Ta(t){return re.put(`/admin/admin-users/${t.id}/basic-info`,{name:t.name,username:t.username,role_id:t.role_id})}function Oa(t){return re.put(`/admin/admin-users/${t.id}/password`,{password:t.password,confirm_password:t.confirm_password})}function ja(t){return re.delete(`/admin/admin-users/${t}/delete`)}const Na={class:"mt-3 d-flex align-center justify-space-around py-6"},Wa={style:{width:"max-content"},class:"d-flex align-center"},Ka={class:"ml-3"},Ha={class:"font-weight-medium text-capitalize"},Qa={class:"text-medium-emphasis"},Ga={class:"w-100 d-flex align-center justify-space-around"},Ja=Y({__name:"AdminDeleteModal",props:{admin:{}},emits:["close","saved"],setup(t,{emit:E}){const f=t,h=E,v=g(!1),d=g(""),o=ce();async function w(){if(d.value="",!f.admin?.id){d.value="Admin id is required.";return}v.value=!0;try{await ja(f.admin.id),o.show({message:"Admin deleted successfully.",color:"success"}),h("saved",{id:f.admin.id}),h("close")}catch(b){const i=b?.response,c=i?.data?.errors??null;if(i?.status===422&&c&&typeof c=="object"){const $={};for(const[F,_]of Object.entries(c))Array.isArray(_)?$[F]=_.map(y=>String(y)):_!=null&&($[F]=[String(_)]);const C=$.id?.[0]??"Failed to delete admin.";d.value=C,o.show({message:C,color:"error"});return}const V=ye(b);d.value=V,o.show({message:V,color:"error"})}finally{v.value=!1}}return(b,i)=>(D(),le(X,null,[a(Ae,{class:"py-6"},{default:n(()=>[d.value?(D(),W(me,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:n(()=>[k(j(d.value),1)]),_:1})):ve("",!0),P("div",Na,[P("div",Wa,[a(xe,{size:"40",color:"grey-lighten-3"},{default:n(()=>[a(M,{size:"22",color:"grey-darken-1"},{default:n(()=>[...i[0]||(i[0]=[k("mdi-account-circle",-1)])]),_:1})]),_:1}),P("div",Ka,[P("div",Ha,j(t.admin.name??"-"),1),P("div",Qa,"@"+j(t.admin.username??t.admin.email),1)])])])]),_:1}),a(qe,{class:"pb-4"},{default:n(()=>[P("div",Ga,[a(H,{color:"error",variant:"tonal",loading:v.value,disabled:v.value,onClick:w},{default:n(()=>[a(M,{start:""},{default:n(()=>[...i[1]||(i[1]=[k("mdi-delete",-1)])]),_:1}),i[2]||(i[2]=k(" Delete ",-1))]),_:1},8,["loading","disabled"])])]),_:1})],64))}}),Ya={class:"px-6 pt-3"},Xa=Y({__name:"AdminUpdateBasicTab",props:{admin:{}},emits:["saved"],setup(t,{emit:E}){const f=t,h=E,v=g(),d=g([]),o=g(""),w=ce(),b=g(!1),i=g({name:f.admin?.name??"",username:f.admin?.username??"",role_id:f.admin?.role_id??null}),c=g({}),V={required:p=>p?!0:"Required",noSpaces:p=>!p||!/\s/.test(p)?!0:"Username must not contain spaces",lowercase:p=>!p||p===p.toLowerCase()?!0:"Username must be lowercase",allowedChars:p=>!p||/^[a-z0-9_.-]+$/.test(p)?!0:"Only letters, numbers, underscore, dash, and dot are allowed",dotPlacement:p=>!p||!p.startsWith(".")&&!p.endsWith(".")?!0:"Dot cannot be the first or last character"};async function $(){const{data:p}=await Pe(),u=Array.isArray(p)?p:p?.data??[];d.value=u.map(e=>({title:e?.name??"",value:e?.id??""})).filter(e=>e.title&&e.value!=="")}function C(p){typeof p=="string"&&(i.value.username=p.toLowerCase()),_("username")}function F(p){return c.value[p]??[]}function _(p){if(!c.value[p])return;const u={...c.value};delete u[p],c.value=u}async function y(){o.value="",c.value={};const p=await v.value?.validate?.();if(!(p&&p.valid===!1)&&!(!p&&v.value?.validate&&!await v.value.validate())){if(!f.admin?.id){o.value="Admin id is required.";return}b.value=!0;try{const u={id:f.admin.id,name:i.value.name,username:i.value.username,role_id:i.value.role_id},{data:e}=await Ta(u),l=e?.data?.updated??e?.updated??!0,s=e?.data?.message??e?.message??"",m=e?.data?.field??e?.field??"";if(l===!1){m?c.value={[m]:[s||"Invalid value."]}:(o.value=s||"Failed to update admin.",w.show({message:o.value,color:"error"}));return}w.show({message:s||"Admin updated successfully.",color:"success"}),h("saved",e??u)}catch(u){const e=u?.response,l=e?.data?.errors??null;if(e?.status===422&&l&&typeof l=="object"){const m={};for(const[T,R]of Object.entries(l))Array.isArray(R)?m[T]=R.map(N=>String(N)):R!=null&&(m[T]=[String(R)]);c.value=m;return}const s=ye(u);console.error("Failed to update admin:",s),o.value=s,w.show({message:s,color:"error"})}finally{b.value=!1}}}return Se($),(p,u)=>(D(),W(fe,{ref_key:"formRef",ref:v,onSubmit:pe(y,["prevent"])},{default:n(()=>[P("div",Ya,[a(ge,null,{default:n(()=>[a(te,null,{default:n(()=>[a(I,{cols:"12",md:"12",class:"pb-0"},{default:n(()=>[a(B,{modelValue:i.value.name,"onUpdate:modelValue":[u[0]||(u[0]=e=>i.value.name=e),u[1]||(u[1]=e=>_("name"))],label:"Name",variant:"outlined",density:"comfortable",rules:[V.required],"error-messages":F("name"),"prepend-inner-icon":"mdi-account"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"6",class:"pb-0"},{default:n(()=>[a(B,{modelValue:i.value.username,"onUpdate:modelValue":[u[2]||(u[2]=e=>i.value.username=e),C],label:"Username",variant:"outlined",density:"comfortable",autocomplete:"off",rules:[V.required,V.noSpaces,V.lowercase,V.allowedChars,V.dotPlacement],"error-messages":F("username"),"prepend-inner-icon":"mdi-account-circle-outline"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"6",class:"pb-0"},{default:n(()=>[a(Ie,{modelValue:i.value.role_id,"onUpdate:modelValue":[u[3]||(u[3]=e=>i.value.role_id=e),u[4]||(u[4]=e=>_("role_id"))],items:d.value,label:"Role",variant:"outlined",density:"comfortable",clearable:"",rules:[V.required],"error-messages":F("role_id"),"prepend-inner-icon":"mdi-shield-account-outline"},null,8,["modelValue","items","rules","error-messages"])]),_:1}),a(I,{cols:"12",class:"d-flex justify-space-around pt-8"},{default:n(()=>[a(H,{color:"primary",size:"large",variant:"tonal",loading:b.value,disabled:b.value,onClick:y},{default:n(()=>[a(M,{start:""},{default:n(()=>[...u[5]||(u[5]=[k("mdi-content-save-outline",-1)])]),_:1}),u[6]||(u[6]=k(" Update ",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})])]),_:1},512))}}),Za={class:"px-6 pt-3"},el=Y({__name:"AdminUpdateEmailTab",props:{admin:{}},emits:["saved"],setup(t,{emit:E}){const f=t,h=E,v=g(),d=g(""),o=g(!1),w=g({email:f.admin?.email??""}),b=g(""),i=g({}),c={required:_=>_?!0:"Required",email:_=>!_||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_)?!0:"Invalid email"};function V(_){return i.value[_]??[]}function $(_){if(!i.value[_])return;const y={...i.value};delete y[_],i.value=y}function C(){$("email")}async function F(){d.value="",i.value={};const _=await v.value?.validate?.();if(!(_&&_.valid===!1)&&!(!_&&v.value?.validate&&!await v.value.validate())){o.value=!0;try{h("saved",{id:f.admin?.id,email:w.value.email,verification_code:b.value||void 0,tab:"email"})}finally{o.value=!1}}}return(_,y)=>(D(),W(fe,{ref_key:"formRef",ref:v,onSubmit:pe(F,["prevent"])},{default:n(()=>[d.value?(D(),W(me,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:n(()=>[k(j(d.value),1)]),_:1})):ve("",!0),P("div",Za,[a(ge,null,{default:n(()=>[a(te,null,{default:n(()=>[a(I,{cols:"12",md:"12",class:"pb-0"},{default:n(()=>[a(B,{modelValue:w.value.email,"onUpdate:modelValue":[y[0]||(y[0]=p=>w.value.email=p),y[1]||(y[1]=p=>$("email"))],label:"New Email",type:"email",variant:"outlined",density:"comfortable",rules:[c.required,c.email],"error-messages":V("email"),"prepend-inner-icon":"mdi-email-outline"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"7",class:"pb-0"},{default:n(()=>[a(B,{modelValue:b.value,"onUpdate:modelValue":[y[2]||(y[2]=p=>b.value=p),y[3]||(y[3]=p=>$("verification_code"))],label:"Verification Code",variant:"outlined",density:"comfortable",rules:[c.required],"error-messages":V("verification_code"),"prepend-inner-icon":"mdi-shield-key-outline"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"5",class:"pb-0"},{default:n(()=>[a(H,{variant:"tonal",color:"primary",size:"large",disabled:o.value,onClick:C},{default:n(()=>[a(M,{start:""},{default:n(()=>[...y[4]||(y[4]=[k("mdi-email-send-outline",-1)])]),_:1}),y[5]||(y[5]=k(" Send Code ",-1))]),_:1},8,["disabled"])]),_:1}),a(I,{cols:"12",class:"d-flex justify-space-around pt-8"},{default:n(()=>[a(H,{color:"primary",size:"large",variant:"tonal",loading:o.value,disabled:o.value,onClick:F},{default:n(()=>[a(M,{start:""},{default:n(()=>[...y[6]||(y[6]=[k("mdi-content-save-outline",-1)])]),_:1}),y[7]||(y[7]=k(" Update ",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})])]),_:1},512))}}),al={class:"px-6 pt-3"},ll=Y({__name:"AdminUpdatePasswordTab",props:{admin:{}},emits:["saved"],setup(t,{emit:E}){const f=t,h=E,v=g(),d=g(""),o=g(!1),w=ce(),b=g(!1),i=g(!1),c=g({password:"",confirm_password:""}),V=g({}),$={required:u=>u?!0:"Required",passwordMatch:()=>c.value.password===c.value.confirm_password?!0:"Passwords do not match"};function C(u){return V.value[u]??[]}function F(u){if(!V.value[u])return;const e={...V.value};delete e[u],V.value=e}function _(){b.value=!b.value}function y(){i.value=!i.value}async function p(){d.value="",V.value={};const u=await v.value?.validate?.();if(!(u&&u.valid===!1)&&!(!u&&v.value?.validate&&!await v.value.validate())){if(!f.admin?.id){d.value="Admin id is required.",w.show({message:d.value,color:"error"});return}o.value=!0;try{const e={id:f.admin.id,password:c.value.password,confirm_password:c.value.confirm_password},{data:l}=await Oa(e),s=l?.data?.updated??l?.updated??!0,m=l?.data?.message??l?.message??"",T=l?.data?.field??l?.field??"";if(s===!1){T?V.value={[T]:[m||"Invalid value."]}:(d.value=m||"Failed to update password.",w.show({message:d.value,color:"error"}));return}w.show({message:m||"Password updated successfully.",color:"success"}),h("saved",l??e)}catch(e){const l=e?.response,s=l?.data?.errors??null;if(l?.status===422&&s&&typeof s=="object"){const T={};for(const[R,N]of Object.entries(s))Array.isArray(N)?T[R]=N.map(K=>String(K)):N!=null&&(T[R]=[String(N)]);V.value=T;return}const m=ye(e);console.error("Failed to update password:",m),d.value=m,w.show({message:m,color:"error"})}finally{o.value=!1}}}return(u,e)=>(D(),W(fe,{ref_key:"formRef",ref:v,onSubmit:pe(p,["prevent"])},{default:n(()=>[d.value?(D(),W(me,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:n(()=>[k(j(d.value),1)]),_:1})):ve("",!0),P("div",al,[a(ge,null,{default:n(()=>[a(te,null,{default:n(()=>[a(I,{cols:"12",class:"pb-0"},{default:n(()=>[a(B,{modelValue:c.value.password,"onUpdate:modelValue":[e[0]||(e[0]=l=>c.value.password=l),e[1]||(e[1]=l=>F("password"))],label:"New Password",type:b.value?"text":"password",autocomplete:"off",variant:"outlined",density:"comfortable",rules:[$.required],"error-messages":C("password"),"prepend-inner-icon":"mdi-lock-outline","append-inner-icon":b.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":_},null,8,["modelValue","type","rules","error-messages","append-inner-icon"])]),_:1}),a(I,{cols:"12",class:"pb-0"},{default:n(()=>[a(B,{modelValue:c.value.confirm_password,"onUpdate:modelValue":[e[2]||(e[2]=l=>c.value.confirm_password=l),e[3]||(e[3]=l=>F("confirm_password"))],label:"Confirm Password",type:i.value?"text":"password",autocomplete:"off",variant:"outlined",density:"comfortable",rules:[$.required,$.passwordMatch],"error-messages":C("confirm_password"),"prepend-inner-icon":"mdi-lock-check-outline","append-inner-icon":i.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":y},null,8,["modelValue","type","rules","error-messages","append-inner-icon"])]),_:1}),a(I,{cols:"12",class:"d-flex justify-space-around pt-8"},{default:n(()=>[a(H,{color:"primary",size:"large",variant:"tonal",loading:o.value,disabled:o.value,onClick:p},{default:n(()=>[a(M,{start:""},{default:n(()=>[...e[4]||(e[4]=[k("mdi-content-save-outline",-1)])]),_:1}),e[5]||(e[5]=k(" Update ",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})])]),_:1},512))}}),tl=Y({__name:"AdminUpdateModal",props:{admin:{}},emits:["close","saved"],setup(t,{emit:E}){const f=t,h=E,v=g("basic"),d=[{value:"basic",label:"Basic Info",component:Xa},{value:"password",label:"Password",component:ll},{value:"email",label:"Email",component:el}];function o(w){h("saved",w),h("close")}return(w,b)=>(D(),W(Ae,{class:"pt-4"},{default:n(()=>[a(xa,{modelValue:v.value,"onUpdate:modelValue":b[0]||(b[0]=i=>v.value=i),density:"compact",class:""},{default:n(()=>[(D(),le(X,null,Fe(d,i=>a(Aa,{key:i.value,value:i.value},{default:n(()=>[k(j(i.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),a(De),a(Sa,{modelValue:v.value,"onUpdate:modelValue":b[1]||(b[1]=i=>v.value=i)},{default:n(()=>[(D(),le(X,null,Fe(d,i=>a(Pa,{key:i.value,value:i.value,class:"pt-4"},{default:n(()=>[(D(),W(Ia(i.component),{admin:f.admin,onSaved:o},null,40,["admin"]))]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}))}}),nl=Y({__name:"AdminActionButtons",props:{admin:{}},emits:["saved","deleted"],setup(t,{emit:E}){const f=t,h=E;function v(){Ce(tl,{admin:f.admin},{title:"Update Admin",size:"md",onSaved:o=>{h("saved",o)}})}function d(){Ce(Ja,{admin:f.admin},{title:"Confirm Admin Deletion",size:"sm",onSaved:o=>{h("deleted",o)}})}return(o,w)=>(D(),le(X,null,[a(H,{variant:"tonal",color:"primary",size:"x-small",icon:"",onClick:v},{default:n(()=>[a(M,null,{default:n(()=>[...w[0]||(w[0]=[k("mdi-cog",-1)])]),_:1})]),_:1}),a(H,{variant:"tonal",class:"ml-2",color:"error",size:"x-small",icon:"",onClick:d},{default:n(()=>[a(M,null,{default:n(()=>[...w[1]||(w[1]=[k("mdi-delete",-1)])]),_:1})]),_:1})],64))}}),sl={class:"w-100 d-flex align-center justify-space-between px-4 pt-2"},ol=Y({__name:"AdminCreateModal",emits:["close","saved"],setup(t,{emit:E}){const f=E,h=g(),v=g([]),d=g(""),o=g({name:"",email:"",username:"",role_id:null,password:"",confirm_password:""}),w=g({}),b=g(!1),i=g(!1),c=g(!1),V=ce();async function $(){const{data:e}=await Pe(),l=Array.isArray(e)?e:e?.data??[];v.value=l.map(s=>({title:s?.name??"",value:s?.id??""})).filter(s=>s.title&&s.value!=="")}const C={required:e=>e?!0:"Required",email:e=>!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?!0:"Invalid email",noSpaces:e=>!e||!/\s/.test(e)?!0:"Username must not contain spaces",lowercase:e=>!e||e===e.toLowerCase()?!0:"Username must be lowercase",allowedChars:e=>!e||/^[a-z0-9_.-]+$/.test(e)?!0:"Only letters, numbers, underscore, dash, and dot are allowed",dotPlacement:e=>!e||!e.startsWith(".")&&!e.endsWith(".")?!0:"Dot cannot be the first or last character",passwordMatch:()=>o.value.password===o.value.confirm_password?!0:"Passwords do not match"};function F(e){typeof e=="string"&&(o.value.username=e.toLowerCase()),y("username")}function _(e){return w.value[e]??[]}function y(e){if(!w.value[e])return;const l={...w.value};delete l[e],w.value=l}function p(){o.value={name:"",email:"",username:"",role_id:null,password:"",confirm_password:""},d.value="",w.value={},i.value=!1,c.value=!1,h.value?.resetValidation?.()}async function u(){d.value="",w.value={};const e=await h.value?.validate?.();if(!(e&&e.valid===!1)&&!(!e&&h.value?.validate&&!await h.value.validate())){b.value=!0;try{const l={name:o.value.name,email:o.value.email,username:o.value.username,role_id:o.value.role_id,password:o.value.password,confirm_password:o.value.confirm_password},s=await Ba(l);V.show({message:s?.data?.message||"Admin created successfully.",color:"success"}),f("saved",s.data??l),f("close")}catch(l){const s=l?.response,m=s?.data?.errors??null;if(s?.status===422&&m&&typeof m=="object"){const R={};for(const[N,K]of Object.entries(m))Array.isArray(K)?R[N]=K.map(Z=>String(Z)):K!=null&&(R[N]=[String(K)]);w.value=R;return}const T=ye(l);d.value=T}finally{b.value=!1}}}return Se($),(e,l)=>(D(),le(X,null,[a(Ae,{class:"py-6"},{default:n(()=>[d.value?(D(),W(me,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:n(()=>[k(j(d.value),1)]),_:1})):ve("",!0),a(fe,{ref_key:"formRef",ref:h,onSubmit:pe(u,["prevent"])},{default:n(()=>[a(te,null,{default:n(()=>[a(I,{cols:"12",md:"12",class:"pb-0"},{default:n(()=>[a(B,{modelValue:o.value.name,"onUpdate:modelValue":[l[0]||(l[0]=s=>o.value.name=s),l[1]||(l[1]=s=>y("name"))],label:"Name",variant:"outlined",density:"comfortable",rules:[C.required],"error-messages":_("name"),"prepend-inner-icon":"mdi-account"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"12",class:"pb-0"},{default:n(()=>[a(B,{modelValue:o.value.email,"onUpdate:modelValue":[l[2]||(l[2]=s=>o.value.email=s),l[3]||(l[3]=s=>y("email"))],label:"Email",type:"email",variant:"outlined",density:"comfortable",rules:[C.required,C.email],"error-messages":_("email"),"prepend-inner-icon":"mdi-email-outline"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"6",class:"pb-0"},{default:n(()=>[a(B,{modelValue:o.value.username,"onUpdate:modelValue":[l[4]||(l[4]=s=>o.value.username=s),F],label:"Username",variant:"outlined",density:"comfortable",autocomplete:"off",rules:[C.required,C.noSpaces,C.lowercase,C.allowedChars,C.dotPlacement],"error-messages":_("username"),"prepend-inner-icon":"mdi-account-circle-outline"},null,8,["modelValue","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"6",class:"pb-0"},{default:n(()=>[a(Ie,{modelValue:o.value.role_id,"onUpdate:modelValue":[l[5]||(l[5]=s=>o.value.role_id=s),l[6]||(l[6]=s=>y("role_id"))],items:v.value,label:"Role",variant:"outlined",density:"comfortable",clearable:"",rules:[C.required],"error-messages":_("role_id"),"prepend-inner-icon":"mdi-shield-account-outline"},null,8,["modelValue","items","rules","error-messages"])]),_:1}),a(I,{cols:"12",md:"6",class:"pb-0"},{default:n(()=>[a(B,{modelValue:o.value.password,"onUpdate:modelValue":[l[7]||(l[7]=s=>o.value.password=s),l[9]||(l[9]=s=>y("password"))],label:"Password",type:i.value?"text":"password",autocomplete:"off",variant:"outlined",density:"comfortable",rules:[C.required],"error-messages":_("password"),"prepend-inner-icon":"mdi-lock-outline","append-inner-icon":i.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":l[8]||(l[8]=s=>i.value=!i.value)},null,8,["modelValue","type","rules","error-messages","append-inner-icon"])]),_:1}),a(I,{cols:"12",md:"6",class:"pb-0"},{default:n(()=>[a(B,{modelValue:o.value.confirm_password,"onUpdate:modelValue":[l[10]||(l[10]=s=>o.value.confirm_password=s),l[12]||(l[12]=s=>y("confirm_password"))],label:"Confirm Password",type:c.value?"text":"password",autocomplete:"off",variant:"outlined",density:"comfortable",rules:[C.required,C.passwordMatch],"error-messages":_("confirm_password"),"prepend-inner-icon":"mdi-lock-check-outline","append-inner-icon":c.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":l[11]||(l[11]=s=>c.value=!c.value)},null,8,["modelValue","type","rules","error-messages","append-inner-icon"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(qe,{class:"pb-4"},{default:n(()=>[P("div",sl,[a(H,{icon:"",size:"small",variant:"tonal",title:"Reset form",color:"warning",disabled:b.value,onClick:p,"aria-label":"Reset form"},{default:n(()=>[a(M,null,{default:n(()=>[...l[13]||(l[13]=[k("mdi-refresh",-1)])]),_:1})]),_:1},8,["disabled"]),a(H,{color:"primary",variant:"tonal",class:"px-5",loading:b.value,disabled:b.value,onClick:u},{default:n(()=>[a(M,{start:""},{default:n(()=>[...l[14]||(l[14]=[k("mdi-content-save-outline",-1)])]),_:1}),l[15]||(l[15]=k(" submit ",-1))]),_:1},8,["loading","disabled"])])]),_:1})],64))}}),rl=Y({__name:"AdminCreateButton",emits:["saved"],setup(t,{emit:E}){const f=E;function h(){Ce(ol,{},{title:"Add Admin",size:"md",onSaved:v=>{f("saved",v)}})}return(v,d)=>(D(),W(H,{color:"primary",variant:"flat",height:"40",onClick:h},{default:n(()=>[a(M,{start:""},{default:n(()=>[...d[0]||(d[0]=[k("mdi-account-plus",-1)])]),_:1}),d[1]||(d[1]=k(" Add Admin ",-1))]),_:1}))}}),il={class:"text-medium-emphasis"},ul={class:"text-primary",style:{"font-size":"smaller"}},dl={class:"d-flex align-center gap-2"},cl={class:"ml-2"},ml={class:"text-capitalize"},vl={class:"text-medium-emphasis",style:{"font-size":"0.8rem"}},fl={key:1},pl={class:"text-medium-emphasis",style:{"font-size":"0.8rem"}},gl=Y({__name:"AdminListPage",setup(t){const E=[{title:"Name",key:"name",minWidth:"180",sortable:!1},{title:"Role",key:"role",minWidth:"160",sortable:!1},{title:"Email",key:"email",minWidth:"220",sortable:!1},{title:"Created",key:"created_at",minWidth:"100",sortable:!1},{title:"Actions",key:"action",sortable:!1,minWidth:"100"}],f=g([]),h=g(0),v=g(!1),d=g({page:1,itemsPerPage:12,sortBy:[]}),o=g({query:"",role:null}),w=g([]),b=g(!1);async function i(){v.value=!0;try{const{data:l}=await La({page:d.value.page,per_page:d.value.itemsPerPage,search:o.value.query||void 0,role_id:o.value.role??void 0}),s=Array.isArray(l)?l:l?.data??[];f.value=s.map(m=>({...m})),h.value=l?.total??l?.meta?.total??s.length}finally{v.value=!1}}function c(l){d.value=l,b.value||(b.value=!0),i()}function V(){d.value.page=1,i()}function $(l){l||(d.value.page=1,i())}function C(l){l||(d.value.page=1,i())}function F(){d.value.page=1,i()}function _(){d.value.page=1,i()}function y(){d.value.page=1,i()}async function p(){const{data:l}=await Pe(),s=Array.isArray(l)?l:l?.data??[];w.value=s.map(m=>({title:m?.name??"",value:m?.id??""})).filter(m=>m.title&&m.value!=="")}function u(l){const s=l.trim().toLowerCase().replace(/\s+/g,"-"),m={"content-writer":"warning",administrator:"primary",manager:"success",csr:"orange"};return m[s]?m[s]:s.includes("admin")?"primary":s.includes("manager")?"success":s.includes("writer")?"warning":s.includes("csr")?"orange":"grey"}function e(l){const s=l.trim().toLowerCase().replace(/\s+/g,"-"),m={"content-writer":"mdi-pencil",administrator:"mdi-shield-crown-outline",manager:"mdi-briefcase-account-outline",csr:"mdi-headset"};return m[s]?m[s]:s.includes("admin")?"mdi-shield-account-outline":s.includes("manager")?"mdi-briefcase-account-outline":s.includes("writer")?"mdi-pencil":s.includes("csr")?"mdi-headset":"mdi-account-circle-outline"}return Se(()=>{b.value||(i(),b.value=!0),p()}),(l,s)=>(D(),W(ea,{headers:E,items:f.value,total:h.value,loading:v.value,"items-per-page":d.value.itemsPerPage,"onUpdate:options":c},{actions:n(()=>[a(ge,{fluid:""},{default:n(()=>[a(te,null,{default:n(()=>[a(I,{cols:"12",md:"3"},{default:n(()=>[a(B,{modelValue:o.value.query,"onUpdate:modelValue":[s[0]||(s[0]=m=>o.value.query=m),$],density:"compact",variant:"outlined",label:"Search",placeholder:"Search by name, email, or username","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:"",style:{"min-width":"200px"}},null,8,["modelValue"])]),_:1}),a(I,{cols:"12",md:"3"},{default:n(()=>[a(Ie,{modelValue:o.value.role,"onUpdate:modelValue":[s[1]||(s[1]=m=>o.value.role=m),C],items:w.value,density:"compact",variant:"outlined",label:"Role","prepend-inner-icon":"mdi-shield-account-outline","hide-details":"",clearable:"",style:{"min-width":"200px"}},null,8,["modelValue","items"])]),_:1}),a(I,{cols:"12",md:"2",class:"d-flex align-center"},{default:n(()=>[a(H,{color:"primary",variant:"tonal",height:"40",onClick:V},{default:n(()=>[a(M,{start:""},{default:n(()=>[...s[2]||(s[2]=[k("mdi-magnify",-1)])]),_:1}),s[3]||(s[3]=k(" Search ",-1))]),_:1})]),_:1}),a(I,{cols:"12",md:"4",class:"d-flex align-center justify-end"},{default:n(()=>[a(rl,{onSaved:F})]),_:1})]),_:1}),a(te,null,{default:n(()=>[a(I,{cols:"12"},{default:n(()=>[P("div",il,[P("span",ul," Total: "+j(h.value)+" Items found. ",1)])]),_:1})]),_:1})]),_:1})]),"item.name":n(({item:m})=>[P("div",dl,[a(xe,{size:"28",color:"grey-lighten-3"},{default:n(()=>[a(M,{size:"18",color:"grey-darken-1"},{default:n(()=>[...s[4]||(s[4]=[k("mdi-account-circle",-1)])]),_:1})]),_:1}),P("div",cl,[P("div",ml,j(m.name??"-"),1),P("div",vl," @"+j(m.username??"no.username"),1)])])]),"item.role":n(({item:m})=>[m.role?(D(),W(he,{key:0,size:"small",variant:"tonal",class:"text-uppercase font-weight-bold",color:u(m.role),label:""},{default:n(()=>[a(M,{start:"",size:"14"},{default:n(()=>[k(j(e(m.role)),1)]),_:2},1024),k(" "+j(m.role),1)]),_:2},1032,["color"])):(D(),le("span",fl,"-"))]),"item.action":n(({item:m})=>[a(nl,{admin:m,onSaved:_,onDeleted:y},null,8,["admin"])]),"item.created_at":n(({item:m})=>[P("span",pl,j(m.created_at??"-"),1)]),_:1},8,["items","total","loading","items-per-page"]))}}),Cl=$a(gl,[["__scopeId","data-v-8e4dd856"]]);export{Cl as default};
